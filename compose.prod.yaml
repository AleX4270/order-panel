services:
    # traefik:
    #     command:
    #         - "--providers.docker=true"
    #         - "--providers.docker.exposedByDefault=false"
    #         - "--api.insecure=false"

    #         - "--entrypoints.web.address=:80"
    #         - "--entrypoints.websecure.address=:443"
    #         - "--entrypoints.websecure.http.tls=true"
    #         - "--entrypoints.websecure.http.tls.certresolver=le"

    #         - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
    #         - "--entrypoints.web.http.redirections.entrypoint.scheme=https"
    #         - "--entrypoints.web.http.redirections.entrypoint.permanent=true"

    #         - "--certificatesresolvers.le.acme.storage=/letsencrypt/acme.json"
    #         - "--certificatesresolvers.le.acme.httpchallenge.entrypoint=web"
    #     ports:
    #         - "80:80"
    #         - "443:443"
    #     volumes:
    #         - letsencrypt:/letsencrypt
    frontend:
        container_name: frontend
        build:
            context: .
            dockerfile: frontend/Dockerfile
        restart: unless-stopped
        networks:
            - order-panel-network
            - traefik_proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.frontend.rule=Host(`${FRONTEND_URL}`)"
            - "traefik.http.routers.frontend.rule=PathPrefix(`/`)"
            - "traefik.http.routers.frontend.entrypoints=websecure"
            - "traefik.http.routers.frontend.tls=true"
    backend:
        container_name: backend
        build:
            context: .
            dockerfile: backend/Dockerfile
        restart: unless-stopped
        volumes:
            - backend-vendor:/var/www/html/vendor
        depends_on:
            - database
        networks:
            - order-panel-network
            - traefik_proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.backend.rule=Host(`${BACKEND_URL}`)"
            - "traefik.http.routers.backend.rule=PathPrefix(`/api`)"
            - "traefik.http.routers.backend.entrypoints=websecure"
            - "traefik.http.routers.backend.tls=true"

volumes:
     letsencrypt:

networks:
    traefik_proxy:
         name: traefik_proxy
         driver: bridge
